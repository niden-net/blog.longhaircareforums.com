var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,k,l){c instanceof String&&(c=String(c));for(var m=c.length,a=0;a<m;a++){var b=c[a];if(k.call(l,b,a,c))return{i:a,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,k,l){c!=Array.prototype&&c!=Object.prototype&&(c[k]=l.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,k,l,m){if(k){l=$jscomp.global;c=c.split(".");for(m=0;m<c.length-1;m++){var a=c[m];a in l||(l[a]={});l=l[a]}c=c[c.length-1];m=l[c];k=k(m);k!=m&&null!=k&&$jscomp.defineProperty(l,c,{configurable:!0,writable:!0,value:k})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,l){return $jscomp.findInternal(this,c,l).v}},"es6","es3");
!function(c,k,l,m){XF.isEditorEnabled=function(){return XF.LocalStorage.get("editorDisabled")?!1:!0};XF.setIsEditorEnabled=function(a){a?XF.LocalStorage.remove("editorDisabled"):XF.LocalStorage.set("editorDisabled","1",!0)};XF.Editor=XF.Element.newHandler({options:{maxHeight:.7,minHeight:250,buttonsRemove:"",attachmentTarget:!0,deferred:!1,attachmentUploader:".js-attachmentUpload",attachmentContextInput:"attachment_hash_combined"},edMinHeight:63,$form:null,buttonManager:null,ed:null,mentioner:null,
emojiCompleter:null,uploadUrl:null,init:function(){this.$target.is("textarea")?(this.options.minHeight=Math.max(this.edMinHeight,this.options.minHeight),this.$target.trigger("editor:start",[this]),this.$form=this.$target.closest("form"),this.$form.length||(this.$form=null),this.options.attachmentTarget&&(this.uploadUrl=this.$target.closest("[data-xf-init~=attachment-manager]").find(this.options.attachmentUploader).attr("href")),this.options.deferred||this.startInit()):console.error("Editor can only be initialized on a textarea")},
startInit:function(a){var b=this,e=a&&a.beforeInit,d=a&&a.afterInit;this.$target.css("visibility","").on("froalaEditor.initialized",function(a,c){b.ed=c;e&&e(b,c);b.editorInit();d&&d(b,c)}).froalaEditor(this.getEditorConfig())},getEditorConfig:function(){var a=this.getHeightLimits();a={direction:c.FE.LANGUAGE.xf.direction,editorClass:"bbWrapper",fileUpload:!1,fileMaxSize:4294967296,fileUploadParam:"upload",fileUploadURL:!1,fontFamily:{arial:"Arial","'book antiqua'":"Book Antiqua","'courier new'":"Courier New",
georgia:"Georgia",tahoma:"Tahoma","'times new roman'":"Times New Roman","'trebuchet ms'":"Trebuchet MS",verdana:"Verdana"},fontSize:"9 10 12 15 18 22 26".split(" "),heightMin:a[0],heightMax:a[1],htmlAllowedTags:"a b bdi bdo blockquote br cite code dfn div em h1 h2 h3 h4 h5 h6 hr i img li mark ol p pre s script style small span strike strong sub sup table tbody td tfoot th thead time tr u ul var video wbr".split(" "),key:"ZD3G4J3A8C9A5cD3F3H3H2G3A4D4B6D2E1vDIJ1QCYRWd1GPIb2a1E1==",htmlAllowComments:!1,
imageUpload:!1,imageCORSProxy:null,imageDefaultDisplay:"inline",imageDefaultWidth:"auto",imageEditButtons:"imageAlign imageSize imageAlt | imageReplace imageRemove | imageLink linkOpen linkEdit linkRemove".split(" "),imageManagerLoadURL:!1,imageMaxSize:4294967296,imagePaste:!1,imageResize:!0,imageUploadParam:"upload",imageUploadRemoteUrls:!1,imageUploadURL:!1,language:"xf",linkAlwaysBlank:!0,linkEditButtons:["linkOpen","linkEdit","linkRemove"],linkInsertButtons:["linkBack"],placeholderText:"",tableResizer:!1,
tableEditButtons:["tableHeader","tableRemove","|","tableRows","tableColumns"],toolbarSticky:!1,videoAllowedTypes:["mp4","quicktime","ogg","webm"],videoAllowedProviders:[],videoDefaultAlign:"left",videoDefaultDisplay:"inline",videoDefaultWidth:500,videoEditButtons:["videoReplace","videoRemove","|","videoAlign","videoSize"],videoInsertButtons:["videoBack","|","videoUpload"],videoMaxSize:4294967296,videoMove:!0,videoUpload:!1,videoUploadParam:"upload",videoUploadURL:!1,zIndex:XF.getElEffectiveZIndex(this.$target)+
1,xfBbCodeAttachmentContextInput:this.options.attachmentContextInput};c.FE.DT=!0;c.FE.DefineIconTemplate("xf_font_awesome_5",'<i class="fa'+XF.config.fontAwesomeWeight+' fa-[NAME]" aria-hidden="true"></i>');c.FE.ICON_DEFAULT_TEMPLATE="xf_font_awesome_5";c.FE.DefineIcon("insertVideo",{NAME:"video-plus"});c.FE.DefineIcon("undo",{NAME:"undo"});c.FE.DefineIcon("redo",{NAME:"redo"});c.FE.DefineIcon("tableHeader",{NAME:"heading"});if(this.uploadUrl){var b={_xfToken:XF.config.csrf,_xfResponseType:"json",
_xfWithData:1};a.fileUpload=!0;a.fileUploadParams=b;a.fileUploadURL=this.uploadUrl;a.imageUpload=!0;a.imageUploadParams=b;a.imageUploadURL=this.uploadUrl;a.imagePaste=!0;a.videoUpload=!0;a.videoUploadParams=b;a.videoUploadURL=this.uploadUrl}else a.imageInsertButtons=["imageByURL"];b=this.getButtonConfig();a=c.extend({},a,b);this.$target.trigger("editor:config",[a,this]);return a},getButtonConfig:function(){try{var a=c.parseJSON(c(".js-editorToolbars").first().html())||{}}catch(f){console.error("Editor buttons data not valid: ",
f);return}var b={};try{var e=c.parseJSON(c(".js-editorDropdowns").first().html())||{},d;for(d in e)e.hasOwnProperty(d)&&e[d].buttons&&(b[d]=e[d].buttons)}catch(f){console.error("Editor dropdowns data not valid: ",f)}this.buttonManager=a=new XF.EditorButtons(this,a,b);this.$form&&this.$form.is("[data-xf-init~=draft]")||a.addRemovedButton("xfDraft");(b=this.getAttachmentManager())&&b.supportsVideoUploads||a.addRemovedButton("insertVideo");this.options.buttonsRemove&&a.addRemovedButtons(this.options.buttonsRemove.split(","));
this.$target.trigger("editor:toolbar-buttons",[{buttonManager:a},this]);return a.getToolbars()},editorInit:function(){var a=this,b=this.ed;this.watchEditorHeight();this.$form&&(this.$form.on("ajax-submit:before draft:beforesync",function(){b.$oel.val(a.ed.html.get())}),this.$form.on("draft:complete",function(){var a=b.$tb.find(".fr-command.fr-btn[data-cmd=xfDraft]"),d=a.find(".editorDraftIndicator");d.length||(d=c('<b class="editorDraftIndicator" />').appendTo(a));setTimeout(function(){d.addClass("is-active")},
50);setTimeout(function(){d.removeClass("is-active")},2500)}),this.$form.on("ajax-submit:before",function(a,d){0<b.$el.find(".fr-uploading").length&&!confirm(XF.phrase("files_being_uploaded_are_you_sure"))&&(d.preventSubmit=!0)}),b.events.on("keydown",function(b){if("Enter"==b.key&&(XF.isMac()?b.metaKey:b.ctrlKey))return b.preventDefault(),a.$form.submit(),!1},!0));b.$tb.find("[data-cmd=align][data-param1=justify]").closest("li").css("display","none");b.events.on("image.inserted",function(a){a.removeClass("fr-dib").addClass("fr-dii")});
b.events.on("image.loaded",function(b){a.replaceBase64ImageWithUpload(b)});b.events.on("image.beforePasteUpload",function(a){if("data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="==a.src)return!1});var e=!1;b.events.on("cut copy",function(a){if((a=b.selection.ranges(0))&&a.commonAncestorContainer){a=a.commonAncestorContainer;a.nodeType==Node.TEXT_NODE&&(a=a.parentNode);var d=c(a).find("p");c(a).find("p").attr("data-xf-p","1");setTimeout(function(){d.removeAttr("data-xf-p")},
0)}});b.events.on("paste.before",function(a){e=!1;if(a&&a.clipboardData&&a.clipboardData.getData){var d="";a=a.clipboardData.types;if(b.helpers.isArray(a))for(var c=0;c<a.length;c++)d+=a[c]+";";else d=a;!/text\/plain/.test(d)||b.browser.mozilla||/text\/html/.test(d)||/text\/rtf/.test(d)&&b.browser.safari||(e=!0)}});b.events.on("paste.beforeCleanup",function(a){e&&(a=a.replace(/\t/g,"    ").replace(/  /g,"&nbsp; ").replace(/  /g,"&nbsp; ").replace(/> /g,">&nbsp;"));a=a.replace(/(<pre[^>]*>)([\s\S]+?)(<\/pre>)/g,
function(a,b,d,c){d=d.replace(/\r?\n/g,"<br>");return b+d+c});a=a.replace(/<p([^>]+)margin-top:\s*0[a-z]*;\s*margin-bottom:\s*0[a-z]*;([^>]*)>([\s\S]*?)<\/p>/g,function(a,b,d,c){return"<p"+b+d+' data-xf-p="1">'+c+"</p>"});a=a.replace(/<div(?=\s|>)/g,function(a){return a+' data-xf-p="1"'});var b;(b=a.match(/^(?:<meta charset=(?:'|")[^'"]*(?:'|")>)?<a href=(?:'|")([^'"]*)\/?(?:'|")>\1<\/a>$/))&&(a=c.trim(b[1]));(b=a.match(/\x3c!--StartFragment--\x3e<a href=(?:'|")([^'"]*)\/?(?:'|")>\1<\/a>\x3c!--EndFragment--\x3e/))&&
(a=c.trim(b[1]));a=XF.adjustHtmlForRte(a);a=c.parseHTML(a);var d=function(a){var b,c;for(b=0;b<a.length;b++){var e=a[b];if(e instanceof Element){if(e.hasAttributes()){var f=e.attributes;for(c=f.length-1;0<=c;c--)"on"==f[c].name.toLowerCase().substr(0,2)&&e.removeAttribute(f[c].name)}d(e.children)}}};d(a);return a=c("<div />").html(a).html()});b.events.on("paste.afterCleanup",function(b){return a.normalizePaste(b)});b.events.on("paste.after",function(){var d=b.selection.ranges(0);if(d&&d.getBoundingClientRect){d=
d.getBoundingClientRect();var e=b.$wp[0].getBoundingClientRect();(0>d.top||0>d.left||d.bottom>c(k).height()||d.right>c(k).width()||d.bottom>e.bottom)&&setTimeout(function(){a.scrollToCursor()},100)}});b.events.on("popups.show.colors.picker",function(){c(this.popups.get("colors.picker")).find(".fr-colors-buttons").css("display","none")});var d={url:XF.getAutoCompleteUrl()};this.mentioner=new XF.AutoCompleter(b.$el,d,b);XF.config.shortcodeToEmoji&&(d={url:XF.canonicalizeUrl("index.php?misc/find-emoji"),
at:":",keepAt:!1,insertMode:"html",displayTemplate:'<div class="contentRow"><div class="contentRow-figure contentRow-figure--emoji">{{{icon}}}</div><div class="contentRow-main contentRow-main--close">{{{text}}}<div class="contentRow-minor contentRow-minor--smaller">{{{desc}}}</div></div></div>',beforeInsert:function(a,b){XF.logRecentEmojiUsage(c(b).find("img.smilie").data("shortname"));return a}},this.emojiCompleter=new XF.AutoCompleter(b.$el,d,b));this.setupUploads();XF.isEditorEnabled()||(d=this.$target.next("input[data-bb-code]"),
d.length?b.bbCode.toBbCode(d.val(),!0):b.bbCode.toBbCode(null,!0));XF.EditorHelpers.setupBlurSelectionWatcher(b);this.$target.on("control:enabled",function(){b.edit.on()});this.$target.on("control:disabled",function(){b.edit.off()});this.$target.on("control:enabled",function(){b.edit.on();b.bbCode&&b.bbCode.isBbCodeView()?b.$tb.find(".fr-command[data-cmd=xfBbCode]").removeClass("fr-disabled"):b.toolbar.enable()});this.$target.on("control:disabled",function(){b.edit.off();b.toolbar.disable();b.$tb.find(" > .fr-command").addClass("fr-disabled")});
this.$target.trigger("editor:init",[b,this]);XF.layoutChange()},focus:function(){XF.EditorHelpers.focus(this.ed)},blur:function(){XF.EditorHelpers.blur(this.ed)},normalizePaste:function(a){a=a.replace(/(<(ul|li|p|div)>)\s+/ig,"$1");a=a.replace(/\s+(<\/(ul|li|p|div)>)/ig,"$1");a=a.replace(/<span>&nbsp;<\/span>/ig," ").replace(/(<\/li>)\s+(<li)/ig,"$1$2");var b=this.ed,e=c.parseHTML(a),d=c("<div />").html(e);d.find("table").each(function(a,b){a=c(b).width("100%");a.wrap('<div class="bbTable"></div>');
a.find("[colspan], [rowspan]").removeAttr("colspan rowspan");var d=0;a.find("> tbody > tr").each(function(){var a=c(this).find("> td, > th").length;d=Math.max(d,a)}).each(function(){var a=c(this).find("> td, > th"),b=a.length;if(b<d){var e="<td />";for(b&&"TH"===a[0].tagName&&(e="<th />");b<d;b++)c(this).append(e)}})});d.find("code, del, ins, sub, sup").replaceWith(function(){return this.innerHTML});d.find("h1, h2, h3, h4, h5, h6").replaceWith(function(){var a="<b>"+this.innerHTML+"</b>",d=b.opts.fontSize;
switch(this.tagName){case "H1":a='<span style="font-size: '+d[6]+'px">'+a+"</span>";break;case "H2":a='<span style="font-size: '+d[5]+'px">'+a+"</span>";break;case "H3":a='<span style="font-size: '+d[4]+'px">'+a+"</span>"}return a+"<br>"});d.find("pre").replaceWith(function(){var a=this.innerHTML;a=a.replace(/\r?\n/g,"<br>").replace(/\t/g,"    ").replace(/  /g,"&nbsp; ").replace(/  /g,"&nbsp; ").replace(/> /g,">&nbsp;").replace(/<br> /g,"<br>&nbsp;");return a+"<br>"});d.find("br").each(function(a,
e){var f=c(e).parents().not(d);if(f.length&&!f.filter(function(a,d){return b.node.isBlock(d)}).length){a=c([]);var h=!1,g=e,n=f.last();do{for(;g.nextSibling;)f=c(g.nextSibling).clone(),h?a.append(f):a=a.add(f),c(g.nextSibling).remove();g=g.parentNode;if(!g||d.is(g))break;f=c(g).clone().empty();f.html(a);a=f;h=!0}while(g.parentNode&&!d.is(g.parentNode));c(e).remove();n.after(a);n.after("<br />")}});a="";e=d[0].textContent.replace(/\s/g,"");try{a=(b.win.localStorage.getItem("fr-copied-text")||"").replace(/\s/g,
"")}catch(n){}a!==e&&d.find("> p:not([data-xf-p])").each(function(){this.nextSibling&&c(this).after("<p />")});d.find("p").removeAttr("data-xf-p");e=d.contents();a=c("<div />");for(var f=null,h=0;h<e.length;h++){var g=e[h];g.nodeType==Node.ELEMENT_NODE&&b.node.isBlock(g)?(a.append(g),f=null):g.nodeType==Node.ELEMENT_NODE&&"BR"==g.tagName?(f||a.append("<p />"),f=null):(f||(f=c("<p />"),a.append(f)),f.append(g))}e=a.children();1==e.length&&e.is("p, div")&&(a=e);return a.html()},watchEditorHeight:function(){var a=
this.ed,b=this;c(k).onPassive("resize",function(){var d=b.getHeightLimits();a.opts.heightMin=d[0];a.opts.heightMax=d[1];a.size.refresh();XF.layoutChange()});a.events.on("focus",function(){b.scrollToCursorAfterPendingResize()});var e=a.$wp.height(),d=function(){var b=a.$wp.height();e!=b&&(e=b,XF.layoutChange())};a.events.on("keyup",d);a.events.on("commands.after",d);a.events.on("html.set",d);a.events.on("init",d);a.events.on("initialized",d)},getHeightLimits:function(){var a=this.options.maxHeight,
b=this.options.minHeight,e=null,d=null;this.$target.closest(".overlay").length&&(a=.1);a&&(e=c(k).height(),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(e-=250),e=Math.floor(0<a?1>=a?e*a:a:e+a),e=Math.max(e,150));b&&e&&(d=Math.min(b,e),d==e&&--d);return[d,e]},setupUploads:function(){var a=this,b=this.ed;b.events.on("file.uploaded",function(b){this.popups.hide("file.insert");this.events.focus();return a.handleUploadSuccess(b)});b.events.on("file.error",function(b,c){this.popups.hide("file.insert");
a.handleUploadError(b,c);this.events.focus();return!1});this.uploadUrl||(b.events.on("image.beforeUpload",function(){return!1}),b.events.on("file.beforeUpload",function(){return!1}),b.events.on("video.beforeUpload",function(){return!1}));b.events.on("image.error",function(b,c){if(c)return this.popups.hide("image.insert"),a.handleUploadError(b,c),!1});b.events.on("video.error",function(b,c){if(c)return this.popups.hide("video.insert"),a.handleUploadError(b,c),!1});b.events.on("image.uploaded",function(d){return a.handleUploadSuccess(d,
function(){b.image.remove();b.popups.hide("image.insert");b.events.focus();return!1},function(){return!0})});b.events.on("video.uploaded",function(d){return a.handleUploadSuccess(d,function(){b.video.remove();b.popups.hide("video.insert");b.events.focus();return!1},function(){return!0})});var e=function(a,b){if(b){try{var d=c.parseJSON(b)}catch(r){return}a.hasClass("fr-video")&&(a=a.find("video"),a.attr("data-xf-init","video-init").attr("style","").empty());if(d.attachment){d=d.attachment.attachment_id;
b=a[0].attributes;for(var e=/^data-(?!xf-init)/,f=b.length-1;0<=f;f--)e.test(b[f].nodeName)&&a.removeAttr(b[f].nodeName);a.attr("data-attachment","full:"+d)}}};b.events.on("image.inserted video.inserted",e);b.events.on("image.replaced video.replaced",e);b.events.on("image.loaded",function(d){if(b.popups.isVisible("image.edit")){var c=b.image.get();c&&c[0]==d[0]&&(b.image.exitEdit(!0),c=b.selection.ranges(0),c.setStartAfter(d[0]),c.collapse(!0),d=b.selection.get(),d.removeAllRanges(),d.addRange(c),
b.events.focus(),a.scrollToCursor())}});b.events.on("video.loaded",function(d){if(b.popups.isVisible("video.edit")){var c=b.video.get();c&&c[0]==d[0]&&(b.events.trigger("video.hideResizer"),b.popups.hide("video.edit"),c=b.selection.ranges(0),c.setStartAfter(d[0]),c.collapse(!0),d=b.selection.get(),d.removeAllRanges(),d.addRange(c),b.events.focus(),a.scrollToCursor())}});b.events.on("popups.show.image.edit",function(){var a=b.image.get();a.length&&a.hasClass("smilie")&&(b.image.exitEdit(!0),b.selection.save(),
setTimeout(function(){b.selection.restore()},0))})},handleUploadSuccess:function(a,b,e){try{var d=c.parseJSON(a)}catch(f){d={status:"error",errors:[XF.phrase("oops_we_ran_into_some_problems")]}}return d.status&&"error"==d.status?(XF.alert(d.errors[0]),b?b(d):!1):(a=this.getAttachmentManager())&&d.attachment?(a.insertUploadedRow(d.attachment),e?e(d,a):!1):!1},handleUploadError:function(a,b){try{var e=c.parseJSON(b)}catch(d){e=null}e&&e.errors||(e={status:"error",errors:[XF.phrase("oops_we_ran_into_some_problems")]});
XF.alert(e.errors[0])},getAttachmentManager:function(){var a=this.$target.closest("[data-xf-init~=attachment-manager]");return a&&a.length?XF.Element.getHandler(a,"attachment-manager"):null},isBbCodeView:function(){return this.ed.bbCode&&this.ed.bbCode.isBbCodeView?this.ed.bbCode.isBbCodeView():!1},insertContent:function(a,b){var c=this.ed;this.isBbCodeView()?"undefined"!==typeof b&&c.bbCode.insertBbCode(b):(this.focus(),c.html.insert(a),XF.Element.initialize(c.$el));this.scrollToCursor();this.scrollToCursorAfterPendingResize()},
replaceContent:function(a,b){var c=this.ed;this.isBbCodeView()?"undefined"!==typeof b&&c.bbCode.replaceBbCode(b):c.html.set(a)},scrollToCursor:function(){var a=this.ed;if(this.isBbCodeView())a.bbCode.getTextArea().autofocus(),a.$box[0].scrollIntoView(!0);else{this.focus();var b=a.$box,c=a.$wp,d=a.selection.endElement(),f=d.getBoundingClientRect().bottom,h=!0,g=XF.windowHeight();XF.browser.ios&&(g-=250);if(0>f||f>=g)h=!1;if(c&&h){var n=c[0].getBoundingClientRect();if(f>n.bottom||f<n.top)h=!1}if(!h){f=
b[0].getBoundingClientRect();if(0>f.top||f.bottom>=g)XF.browser.ios||b.addClass("is-scrolling-to"),b[0].scrollIntoView(!0),b.removeClass("is-scrolling-to");c?(b=a.position.getBoundingRect().top,b>c.offset().top-a.helpers.scrollTop()+c.height()-50&&c.scrollTop(b+c.scrollTop()-(c.height()+c.offset().top)+a.helpers.scrollTop()+g/2)):d.scrollIntoView()}}},scrollToCursorAfterPendingResize:function(a){var b=this,e=this.ed,d,f=function(){c(k).off("resize",f);c(k).on("scroll",h);d&&clearTimeout(d);d=setTimeout(g,
500)},h=function(){d&&clearTimeout(d);d=setTimeout(g,100)},g=function(){c(k).off("scroll",h);e.core.hasFocus()&&b.scrollToCursor()};c(k).on("resize",f);setTimeout(function(){c(k).off("resize",f)},2E3);a&&(d=setTimeout(g,1E3))},base64ToBytes:function(a,b){b=b||512;a=atob(a);for(var c=[],d=0;d<a.length;d+=b){for(var f=a.slice(d,d+b),h=Array(f.length),g=0;g<f.length;g++)h[g]=f.charCodeAt(g);f=new Uint8Array(h);c.push(f)}return c},editorSupportsUploads:function(){return-1!==this.ed.opts.imageInsertButtons.indexOf("imageUpload")},
imageMatchesBase64Encoding:function(a){return a.attr("src").match(/^data:(image\/([a-z0-9]+));base64,(.*)$/)},replaceBase64ImageWithUpload:function(a){if(!a.hasClass("smilie")){var b;if(b=this.imageMatchesBase64Encoding(a)){var c=b[1];var d=b[2];b=b[3];-1===this.ed.opts.imageAllowedTypes.indexOf(d)?a[0].remove():this.editorSupportsUploads()?(a=new Blob(this.base64ToBytes(b),{type:c}),1024<a.size&&this.ed.image.upload([a])):a[0].remove()}}}});XF.EditorButtons=XF.create({xfEd:null,buttonClasses:null,
toolbars:{},dropdowns:{},removeButtons:null,recalculateNeeded:!0,__construct:function(a,b,c){this.xfEd=a;this.removeButtons=[];b&&(this.toolbars=b);c&&(this.dropdowns=c)},addToolbar:function(a,b){this.toolbars[a]=b;this.recalculateNeeded=!0},adjustToolbar:function(a,b){var c=this.toolbars[a];return c?(this.toolbars[a]=b(c,a,this),this.recalculateNeeded=!0):!1},adjustToolbars:function(a){for(var b in this.toolbars)this.toolbars.hasOwnProperty(b)&&this.adjustToolbar(b,a)},getToolbar:function(a){return this.getToolbars()[a]},
getToolbars:function(){this.recalculateIfNeeded();return this.toolbars},addDropdown:function(a,b){this.dropdowns[a]=b;this.recalculateNeeded=!0},adjustDropdown:function(a,b){var c=this.dropdowns[a];return c?(this.dropdowns[a]=b(c,a,this),this.recalculateNeeded=!0):!1},adjustDropdowns:function(a){for(var b in this.dropdowns)this.dropdowns.hasOwnProperty(b)&&this.adjustDropdown(b,a)},getDropdown:function(a){return this.getDropdowns()[a]},getDropdowns:function(){this.recalculateIfNeeded();return this.dropdowns},
addRemovedButton:function(a){this.removeButtons.push(a);this.recalculateNeeded=!0},addRemovedButtons:function(a){for(var b=0;b<a.length;b++)this.removeButtons.push(a[b]);this.recalculateNeeded=!0},recalculateIfNeeded:function(){this.recalculateNeeded&&this.recalculate()},recalculate:function(){function a(a,b){"string"==typeof b&&f[b]&&(b=f[b]);"string"==typeof b&&(b=b.split("|"));return a.filter(function(a){return!(0<=b.indexOf(a))})}function b(a){var b=[];for(g=0;g<a.length;g++){var c=a[g];var d=
"-vs"===c||"|"===c;var e="-hs"===c||"-"===c;if(d||e){c=d?"|":"-";if(e&&!b.length)continue;if(b.length){d=b[b.length-1];if(d===c)continue;e&&"|"===d&&b.pop()}}b.push(c)}return b}for(var c=this.removeButtons,d,f=this.getButtonClasses(),h,g=0;g<c.length;g++){d=c[g];for(h in this.toolbars)this.toolbars.hasOwnProperty(h)&&(this.toolbars[h]=a(this.toolbars[h],d));for(h in this.dropdowns)this.dropdowns.hasOwnProperty(h)&&(this.dropdowns[h]=a(this.dropdowns[h],d))}for(h in this.dropdowns)if(this.dropdowns.hasOwnProperty(h)&&
!this.dropdowns[h].length)for(var n in this.toolbars)this.toolbars.hasOwnProperty(n)&&(this.toolbars[n]=a(this.toolbars[n],h));for(h in this.toolbars)this.toolbars.hasOwnProperty(h)&&(this.toolbars[h]=b(this.toolbars[h],d));for(h in this.dropdowns)this.dropdowns.hasOwnProperty(h)&&(this.dropdowns[h]=b(this.dropdowns[h],d));this.recalculateNeeded=!1},getButtonClasses:function(){this.buttonClasses||(this.buttonClasses={_basic:["bold","italic","underline","strikeThrough"],_extended:["color","fontFamily",
"fontSize","xfInlineCode"],_link:["insertLink"],_align:["align"],_list:["formatOL","formatUL","outdent","indent"],_indent:["outdent","indent"],_smilies:["xfSmilie"],_image:["insertImage"],_media:["insertVideo","xfMedia"],_block:["xfQuote","xfCode","xfSpoiler","xfInlineSpoiler","insertTable"]});return this.buttonClasses}});XF.EditorHelpers={setupBlurSelectionWatcher:function(a){var b=a.$el,e=!1,d;c(l).on("mousedown keydown",function(b){e&&(a.$el[0]==b.target||c.contains(a.$el[0],b.target)||a.selection.inEditor()&&
(d=a.selection.ranges(0)))});a.events.on("blur",function(){d?b.data("xf-ed-blur-sel",d):b.removeData("xf-ed-blur-sel");e=!1;d=null},!0);a.events.on("focus",function(){e=!0;d=null;setTimeout(function(){b.removeData("xf-ed-blur-sel")},0)});a.events.on("commands.before",function(b){(b=c.FE.COMMANDS[b])&&("undefined"==typeof b.focus||b.focus)&&XF.EditorHelpers.restoreMaintainedSelection(a)})},restoreMaintainedSelection:function(a){var b=a.$el.data("xf-ed-blur-sel");a.selection.inEditor()||(b?(a.markers.remove(),
a.markers.place(b,!0,0),a.markers.place(b,!1,0)):a.selection.setAtEnd(a.el),a.selection.restore())},focus:function(a){XF.EditorHelpers.restoreMaintainedSelection(a);a.events.focus()},blur:function(a){a.$el[0].blur();a.selection.clear()},wrapSelectionText:function(a,b,c,d){d&&a.selection.save();d=a.$el.find(".fr-marker");d.first().before(XF.htmlspecialchars(b));d.last().after(XF.htmlspecialchars(c));a.selection.restore();a.placeholder.hide()},insertCode:function(a,b,c){switch(b.toLowerCase()){case "":var d=
"CODE";b="";break;default:d="CODE",b=b.toLowerCase()}c=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\t/g,"    ").replace(/\n /g,"\n&nbsp;").replace(/  /g,"&nbsp; ").replace(/  /g," &nbsp;").replace(/\n/g,"</p><p>");c="["+d+(b?"="+b:"")+"]"+c+"[/"+d+"]";c.match(/<\/p>/i)&&(c=("<p>"+c+"</p>").replace(/<p><\/p>/g,"<p><br></p>"));a.html.insert(c)},insertSpoiler:function(a,b){XF.EditorHelpers.wrapSelectionText(a,b?'[SPOILER="'+b+'"]':"[SPOILER]","[/SPOILER]",
!0)},dialogs:{},loadDialog:function(a,b){var c=XF.EditorHelpers.dialogs;c[b]?c[b].show(a):console.error("Unknown dialog '"+b+"'")}};XF.EditorDialog=XF.create({ed:null,overlay:null,dialog:null,cache:!0,__construct:function(a){this.dialog=a},show:function(a){this.ed=a;a.selection.save();XF.loadOverlay(XF.canonicalizeUrl("index.php?editor/dialog&dialog="+this.dialog),{beforeShow:XF.proxy(this,"beforeShow"),afterShow:XF.proxy(this,"afterShow"),init:XF.proxy(this,"init"),cache:this.cache})},init:function(a){var b=
this;a.on("overlay:hidden",function(){b.ed&&b.ed.markers.remove()});this._init(a)},_init:function(a){},beforeShow:function(a){this.overlay=a;this._beforeShow(a)},_beforeShow:function(a){},afterShow:function(a){this._afterShow(a);a.$overlay.find("textarea, input").first().focus()},_afterShow:function(a){}});XF.EditorDialogMedia=XF.extend(XF.EditorDialog,{_beforeShow:function(a){c("#editor_media_url").val("")},_init:function(a){c("#editor_media_form").submit(XF.proxy(this,"submit"))},submit:function(a){a.preventDefault();
var b=this.ed,e=this.overlay;XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/media"),{url:c("#editor_media_url").val()},function(a){a.matchBbCode?(b.selection.restore(),b.html.insert(XF.htmlspecialchars(a.matchBbCode)),e.hide()):a.noMatch?XF.alert(a.noMatch):(b.selection.restore(),e.hide())})}});XF.EditorDialogSpoiler=XF.extend(XF.EditorDialog,{_beforeShow:function(a){c("#editor_spoiler_title").val("")},_init:function(a){c("#editor_spoiler_form").submit(XF.proxy(this,"submit"))},submit:function(a){a.preventDefault();
a=this.ed;var b=this.overlay;a.selection.restore();XF.EditorHelpers.insertSpoiler(a,c("#editor_spoiler_title").val());b.hide()}});XF.EditorDialogCode=XF.extend(XF.EditorDialog,{_beforeShow:function(a){this.ed.$el.blur();a.$container.on("overlay:shown",function(){var a=c(this).find(".CodeMirror");a.length&&a[0].CodeMirror?a[0].CodeMirror.focus():c(this).find(".js-codeEditor").focus()})},_init:function(a){c("#editor_code_form").submit(XF.proxy(this,"submit"))},submit:function(a){a.preventDefault();
a=this.ed;var b=this.overlay,e=b.$container.find(".CodeMirror");if(e.length){e=e[0].CodeMirror;var d=e.getDoc();e.save();d.setValue("");e.setOption("mode","")}e=c("#editor_code_type");d=c("#editor_code_code");a.selection.restore();XF.EditorHelpers.insertCode(a,e.val(),d.val());b.hide();d.val("");e.val("")}});XF.editorStart={started:!1,custom:[],startAll:function(){XF.editorStart.started||(XF.editorStart.setupLanguage(),XF.editorStart.registerOverrides(),XF.editorStart.registerCommands(),XF.editorStart.registerCustomCommands(),
XF.editorStart.registerEditorDropdowns(),XF.editorStart.registerDialogs(),c(l).trigger("editor:first-start"),XF.editorStart.started=!0)},setupLanguage:function(){var a=c("html").attr("dir");try{var b=c.parseJSON(c(".js-editorLanguage").first().html())||{}}catch(e){console.error(e),b={}}c.FE.LANGUAGE.xf={translation:b,direction:a?a.toLowerCase():"ltr"}},registerOverrides:function(){var a=c.FE.MODULES.helpers;c.FE.MODULES.helpers=function(b){b=a(b);var c=b.sanitizeURL;b.sanitizeURL=function(a){return c(a).replace(/["']/g,
"")};return b}},registerCommands:function(){c.FE.DefineIcon("xfQuote",{NAME:"quote-right"});c.FE.RegisterCommand("xfQuote",{title:"Quote",icon:"xfQuote",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,"[QUOTE]","[/QUOTE]",!0)}});c.FE.DefineIcon("xfCode",{NAME:"code"});c.FE.RegisterCommand("xfCode",{title:"Code",icon:"xfCode",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.loadDialog(this,"code")}});c.FE.DefineIcon("xfInlineCode",{NAME:"terminal"});c.FE.RegisterCommand("xfInlineCode",
{title:"Inline Code",icon:"xfInlineCode",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,"[ICODE]","[/ICODE]",!0)}});c.FE.DefineIcon("xfMedia",{NAME:"video"});c.FE.RegisterCommand("xfMedia",{title:"Media",icon:"xfMedia",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.loadDialog(this,"media")}});c.FE.DefineIcon("xfSpoiler",{NAME:"flag"});c.FE.RegisterCommand("xfSpoiler",{title:"Spoiler",icon:"xfSpoiler",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.loadDialog(this,
"spoiler")}});c.FE.DefineIcon("xfInlineSpoiler",{NAME:"flag-checkered"});c.FE.RegisterCommand("xfInlineSpoiler",{title:"Inline Spoiler",icon:"xfInlineSpoiler",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,"[ISPOILER]","[/ISPOILER]",!0)}});c.FroalaEditor.PLUGINS.xfSmilie=function(a){function b(b){var d=c(b.currentTarget);b=d.html();if(!c(b).hasClass("smilie--lazyLoad")){XF.EditorHelpers.focus(a);a.html.insert(b);n();XF.EditorHelpers.blur(a);if(p){var e=p.find(".js-emojiInsertedRow");
e.find(".js-emojiInsert").html(b);e.addClassTransitioned("is-active");clearTimeout(v);v=setTimeout(function(){e.removeClassTransitioned("is-active")},1500)}clearTimeout(w);w=setTimeout(function(){XF.logRecentEmojiUsage(d.data("shortname"))},1500)}}function e(a,b){for(var d,e,g=0;g<a.length;g++)d=a[g],d.isIntersecting&&(e=c(d.target),f(e),b.unobserve(d.target))}function d(a,b){var d=a;a instanceof Event&&(d=c(a.currentTarget));if(b||d.is(":visible")){var e=d[0].getBoundingClientRect(),g=e.bottom+100;
d.children().each(function(){var a=c(this),b=this.getBoundingClientRect();if(!(b.bottom<e.top)){if(b.top>g)return!1;a.find("span.smilie--lazyLoad").each(function(){var a=c(this);this.getBoundingClientRect().top<=g&&f(a)})}})}}function f(a){var b=c("<img />").attr({"class":a.attr("class").replace(/(\s|^)smilie--lazyLoad(\s|$)/," "),alt:a.attr("data-alt"),title:a.attr("title"),src:a.attr("data-src"),"data-shortname":a.attr("data-shortname")}),d=function(){var c=function(){a.replaceWith(b)};k.requestAnimationFrame?
k.requestAnimationFrame(c):c()};if(b.prop("complete"))d();else b.on("load",d)}function h(){var a=c(this),e=p.find(".js-emojiFullList"),g=p.find(".js-emojiSearchResults");clearTimeout(x);x=setTimeout(function(){var c=a.val();if(!c||2>c.length)g.hide(),e.show(),d(e);else{var f=XF.canonicalizeUrl("index.php?editor/smilies-emoji/search");XF.ajax("GET",f,{q:c},function(a){a.html&&XF.setupHtmlInsert(a.html,function(a){a.find(".js-emoji").on("click",b);e.hide();g.replaceWith(a)})})}},300)}function g(){var a=
XF.getRecentEmojiUsage(),e=q.find(".js-recentHeader"),g=q.find(".js-recentBlock"),f=g.find(".js-recentList"),h=q.find(".js-emojiList");if(a){var n=f.clone(),k=[];n.empty();for(var l in a){var p=a[l],m;h.each(function(){m=c(this).find('.js-emoji[data-shortname="'+p+'"]').closest("li").clone();if(m.length)return m.find(".js-emoji").on("click",b),k.push(m),!1})}for(l in k)k[l].appendTo(n);f.replaceWith(n);g.hasClass("is-hidden")&&(g.hide(),g.removeClass("is-hidden"),e.removeClass("is-hidden"),g.xfFadeDown(XF.config.speed.fast));
d(n,!0)}}function n(){a.selection.save()}function r(){a.selection.restore()}var m=!1,t=!1,p,q,u=0,v,w,x;return{showMenu:function(){n();XF.EditorHelpers.blur(a);var f=a.$tb.find('.fr-command[data-cmd="xfSmilie"]');if(!m){m=!0;p=c(c.parseHTML(Mustache.render(c(".js-xfSmilieMenu").first().html())));p.insertAfter(f);f.data("xf-click","menu");var y=XF.Event.getElementHandler(f,"menu","click");p.on("menu:complete",function(){q=p.find(".menu-scroller");if(!t){t=!0;if(k.IntersectionObserver){var f=new IntersectionObserver(e,
{root:q[0],rootMargin:"0px 0px 100px 0px"});q.find("span.smilie--lazyLoad").each(function(){f.observe(this)})}else q.onPassive("scroll",d);q.find(".js-emoji").on("click",b);var m=p.find(".js-emojiSearch");m.on("focus",n);m.on("blur",r);m.on("input",h);p.find(".js-emojiCloser").on("click",function(){XF.EditorHelpers.focus(a)});c(l).on("recent-emoji:logged",g);a.events.on("commands.mousedown",function(a){"xfSmilie"!=a.data("cmd")&&y.close()});p.on("menu:closed",function(){u=q.scrollTop()})}q.scrollTop(u);
k.IntersectionObserver||d(q)});p.on("menu:closed",function(){setTimeout(function(){a.markers.remove()},50)})}(f=f.data("xfClickHandlers"))&&f.menu&&f.menu.toggle()}}};c.FE.DefineIcon("xfSmilie",{NAME:"smile"});c.FE.RegisterCommand("xfSmilie",{title:"Smilies",icon:"xfSmilie",undo:!1,focus:!1,refreshOnCallback:!1,callback:function(){this.xfSmilie.showMenu()}});c.FE.DefineIcon("xfDraft",{NAME:"save"});c.FE.RegisterCommand("xfDraft",{type:"dropdown",title:"Drafts",focus:!0,undo:!1,options:{xfDraftSave:"Save Draft",
xfDraftDelete:"Delete Draft"},callback:function(a,b){a=this.$el.closest("form");a.length?(a=XF.Element.getHandler(a,"draft"))?"xfDraftSave"==b?a.triggerSave():"xfDraftDelete"==b&&a.triggerDelete():console.error("No draft handler on parent form"):console.error("No parent form to find draft handler")}});c.extend(c.FE.DEFAULTS,{xfBbCodeAttachmentContextInput:"attachment_hash_combined"});c.FE.PLUGINS.bbCode=function(a){function b(){return a.$tb.find(".fr-command[data-cmd=xfBbCode]")}function e(){var b=
a.$oel,d=b.data("xfBbCodeBox");if(!d){var e=parseInt(a.$wp.css("border-bottom-width"),10)+parseInt(a.$wp.css("border-top-width"),10);d=c('<textarea class="input" style="display: none" />');d.attr("aria-label",XF.htmlspecialchars(XF.phrase("rich_text_box")));d.css({minHeight:a.opts.heightMin?a.opts.heightMin+e+"px":null,maxHeight:a.opts.heightMax?a.opts.heightMax+"px":null,height:a.opts.height?a.opts.height+e+"px":null,padding:a.$el.css("padding")});d.attr("name",b.data("original-name"));b.data("xfBbCodeBox",
d);a.$wp.after(d);XF.Element.applyHandler(d,"textarea-handler");XF.Element.applyHandler(d,"user-mentioner");XF.Element.applyHandler(d,"emoji-completer")}return d}function d(c,d){var f=e(),g=function(c,d){h=!0;a.undo.saveStep();a.$el.blur();var e=b();a.$tb.find(" > .fr-command").not(e).addClass("fr-disabled");e.addClass("fr-active");a.$wp.css("display","none");a.$oel.prop("disabled",!0);f.val(c).css("display","").prop("disabled",!1).trigger("autosize");d||f.autofocus();XF.setIsEditorEnabled(!1)};"string"==
typeof c?g(c,d):XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-bb-code"),{html:a.html.get()},function(a){g(a.bbCode,d)})}function f(d){var f=e(),g=function(c){h=!1;var d=b();a.$tb.find(" > .fr-command").not(d).removeClass("fr-disabled");d.removeClass("fr-active");a.$oel.prop("disabled",!1);a.html.set(c);f.css("display","none").prop("disabled",!0);a.$wp.css("display","");a.events.focus();a.undo.saveStep();a.size.refresh();XF.setIsEditorEnabled(!0);XF.layoutChange()};if("string"==typeof d)g(d);
else{d={bb_code:f.val()};var k=a.$el.closest("form");k.length&&k[0][a.opts.xfBbCodeAttachmentContextInput]&&(d.attachment_hash_combined=c(k[0][a.opts.xfBbCodeAttachmentContextInput]).val());XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-html"),d,function(a){g(a.editorHtml)})}}var h=!1;return{_init:function(){a.events.on("buttons.refresh",function(){return!h})},toBbCode:d,isBbCodeView:function(){return h},getTextArea:function(){return h?e():null},insertBbCode:function(a){if(h){var b=e();XF.insertIntoTextBox(b,
a)}},replaceBbCode:function(a){if(h){var b=e();XF.replaceIntoTextBox(b,a)}},toHtml:f,toggle:function(){h?f():d()}}};c.FE.DefineIcon("xfBbCode",{NAME:"cog"});c.FE.RegisterCommand("xfBbCode",{title:"Toggle BB Code",icon:"xfBbCode",undo:!1,focus:!1,forcedRefresh:!0,callback:function(){this.bbCode.toggle()}})},registerCustomCommands:function(){try{var a=c.parseJSON(c(".js-editorCustom").first().html())||{}}catch(e){console.error(e),a={}}for(var b in a)a.hasOwnProperty(b)&&function(a,b){var d="xfCustom_"+
a,e=a.toUpperCase();a={};"fa"==b.type?a=(a=b.value.match(/^fa([slrb]) fa-(.+)$/))?{FA5NAME:a[2],template:"font_awesome_5"+("s"===a[1]?"":a[1])}:{NAME:b.value}:"image"==b.type&&(a={template:"image",SRC:'"'+XF.canonicalizeUrl(b.value)+'"',ALT:'"'+b.title+'"'});c.FE.DefineIcon(d,a);c.FE.RegisterCommand(d,{title:b.title,icon:d,undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,"yes"==b.option?"["+e+"=]":"["+e+"]","[/"+e+"]",!0)}});XF.editorStart.custom.push(d)}(b,a[b])},registerEditorDropdowns:function(){try{var a=
c.parseJSON(c(".js-editorDropdowns").first().html())||{}}catch(e){console.error("Editor dropdowns data not valid: ",e),a={}}for(var b in a)a.hasOwnProperty(b)&&function(a,b){b.icon=b.icon.substr(3);c.FE.DefineIcon(a,{NAME:b.icon});c.FE.RegisterCommand(a,{type:"dropdown",title:b.title,icon:a,undo:!1,focus:!1,html:function(){var d='<ul class="fr-dropdown-list">',e=b.buttons,g,k;(g=XF.getEditorInContainer(this.$oel))&&g.buttonManager&&(e=g.buttonManager.getDropdown(a));for(var l in e)g=e[l],(k=c.FE.COMMANDS[g])&&
(d+='<li><a class="fr-command" data-cmd="'+g+'">'+this.icon.create(k.icon||g)+"&nbsp;&nbsp;"+this.language.translate(k.title)+"</a></li>");return d+"</ul>"}})}(b,a[b])},registerDialogs:function(){XF.EditorHelpers.dialogs.media=new XF.EditorDialogMedia("media");XF.EditorHelpers.dialogs.spoiler=new XF.EditorDialogSpoiler("spoiler");XF.EditorHelpers.dialogs.code=new XF.EditorDialogCode("code")}};c(l).one("editor:start",XF.editorStart.startAll);XF.EditorPlaceholderClick=XF.Event.newHandler({eventNameSpace:"XFEditorPlaceholderClick",
options:{},edInitialized:!1,init:function(){},click:function(a){var b=this.$target,e=this;a=function(){e.edInitialized=!0;b.find(".editorPlaceholder-editor").removeClass("is-hidden");b.find(".editorPlaceholder-placeholder").addClass("is-hidden")};var d=XF.getEditorInContainer(b);d instanceof XF.Editor?this.edInitialized||d.startInit({beforeInit:a,afterInit:function(a,b){b.events.focus(!0);XF.isIOS()&&(a.scrollToCursor(),a.scrollToCursorAfterPendingResize());b.opts.tooltips&&setTimeout(function(){b.tooltip.hide()},
30)}}):(a(),d instanceof c&&d.focus())}});XF.Event.register("click","editor-placeholder","XF.EditorPlaceholderClick");XF.Element.register("editor","XF.Editor")}(jQuery,window,document);
